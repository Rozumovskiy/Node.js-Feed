{"ast":null,"code":"import _classCallCheck from \"/home/bogdan/Documents/Node Js/React + node restapi/React/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/bogdan/Documents/Node Js/React + node restapi/React/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/bogdan/Documents/Node Js/React + node restapi/React/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/bogdan/Documents/Node Js/React + node restapi/React/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/bogdan/Documents/Node Js/React + node restapi/React/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/bogdan/Documents/Node Js/React + node restapi/React/src/App.js\";\nimport React, { Component, Fragment } from \"react\";\nimport { Route, Switch, Redirect, withRouter } from \"react-router-dom\";\nimport Layout from \"./components/Layout/Layout\";\nimport Backdrop from \"./components/Backdrop/Backdrop\";\nimport Toolbar from \"./components/Toolbar/Toolbar\";\nimport MainNavigation from \"./components/Navigation/MainNavigation/MainNavigation\";\nimport MobileNavigation from \"./components/Navigation/MobileNavigation/MobileNavigation\";\nimport ErrorHandler from \"./components/ErrorHandler/ErrorHandler\";\nimport FeedPage from \"./pages/Feed/Feed\";\nimport SinglePostPage from \"./pages/Feed/SinglePost/SinglePost\";\nimport LoginPage from \"./pages/Auth/Login\";\nimport SignupPage from \"./pages/Auth/Signup\";\nimport \"./App.css\";\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, App);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(App)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      showBackdrop: false,\n      showMobileNav: false,\n      isAuth: false,\n      token: null,\n      userId: null,\n      authLoading: false,\n      error: null\n    };\n\n    _this.mobileNavHandler = function (isOpen) {\n      _this.setState({\n        showMobileNav: isOpen,\n        showBackdrop: isOpen\n      });\n    };\n\n    _this.backdropClickHandler = function () {\n      _this.setState({\n        showBackdrop: false,\n        showMobileNav: false,\n        error: null\n      });\n    };\n\n    _this.logoutHandler = function () {\n      _this.setState({\n        isAuth: false,\n        token: null\n      });\n\n      localStorage.removeItem(\"token\");\n      localStorage.removeItem(\"expiryDate\");\n      localStorage.removeItem(\"userId\");\n    };\n\n    _this.loginHandler = function (event, authData) {\n      event.preventDefault();\n      var graphqlQuery = {\n        query: \"{\\n        login(email: \\\"\".concat(authData.email, \"\\\", password: \\\"\").concat(authData.password, \"\\\") {\\n          token\\n          userId\\n        }\\n      }\")\n      };\n\n      _this.setState({\n        authLoading: true\n      });\n\n      fetch(\"http://localhost:8080/graphql\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(graphqlQuery)\n      }).then(function (res) {\n        return res.json();\n      }).then(function (resData) {\n        if (resData.errors && resData.errors[0].status === 422) {\n          throw new Error(\"Validation failed. Make sure the email address isn't used yet!\");\n        }\n\n        if (resData.errors) {\n          throw Error(\"User login failed!\");\n        }\n\n        console.log(resData);\n\n        _this.setState({\n          isAuth: true,\n          token: resData.data.token,\n          authLoading: false,\n          userId: resData.userId\n        });\n\n        localStorage.setItem(\"token\", resData.token);\n        localStorage.setItem(\"userId\", resData.userId);\n        var remainingMilliseconds = 60 * 60 * 1000;\n        var expiryDate = new Date(new Date().getTime() + remainingMilliseconds);\n        localStorage.setItem(\"expiryDate\", expiryDate.toISOString());\n\n        _this.setAutoLogout(remainingMilliseconds);\n      }).catch(function (err) {\n        console.log(err);\n\n        _this.setState({\n          isAuth: false,\n          authLoading: false,\n          error: err\n        });\n      });\n    };\n\n    _this.signupHandler = function (event, authData) {\n      event.preventDefault();\n\n      _this.setState({\n        authLoading: true\n      });\n\n      var graphqlQuery = {\n        query: \"\\n        mutation {\\n          createUser(userInput: {email: \\\"\".concat(authData.signupForm.email.value, \"\\\", name: \\\"\").concat(authData.signupForm.name.value, \"\\\", password:\\\"\").concat(authData.signupForm.password.value, \"\\\"}) {\\n            _id\\n            email\\n          }\\n        }\\n      \")\n      };\n      fetch(\"http://localhost:8080/graphql\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(graphqlQuery)\n      }).then(function (res) {\n        return res.json();\n      }).then(function (resData) {\n        if (resData.errors && resData.errors[0].status === 422) {\n          throw new Error(\"Validation failed. Make sure the email address isn't used yet!\");\n        }\n\n        if (resData.errors) {\n          console.log(resData);\n          throw Error(\"User creation failed!\");\n        }\n\n        console.log(resData);\n\n        _this.setState({\n          isAuth: false,\n          authLoading: false\n        });\n\n        _this.props.history.replace(\"/\");\n      }).catch(function (err) {\n        console.log(err);\n\n        _this.setState({\n          isAuth: false,\n          authLoading: false,\n          error: err\n        });\n      });\n    };\n\n    _this.setAutoLogout = function (milliseconds) {\n      setTimeout(function () {\n        _this.logoutHandler();\n      }, milliseconds);\n    };\n\n    _this.errorHandler = function () {\n      _this.setState({\n        error: null\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var token = localStorage.getItem(\"token\");\n      var expiryDate = localStorage.getItem(\"expiryDate\");\n\n      if (!token || !expiryDate) {\n        return;\n      }\n\n      if (new Date(expiryDate) <= new Date()) {\n        this.logoutHandler();\n        return;\n      }\n\n      var userId = localStorage.getItem(\"userId\");\n      var remainingMilliseconds = new Date(expiryDate).getTime() - new Date().getTime();\n      this.setState({\n        isAuth: true,\n        token: token,\n        userId: userId\n      });\n      this.setAutoLogout(remainingMilliseconds);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var routes = React.createElement(Switch, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178\n        },\n        __self: this\n      }, React.createElement(Route, {\n        path: \"/\",\n        exact: true,\n        render: function render(props) {\n          return React.createElement(LoginPage, Object.assign({}, props, {\n            onLogin: _this2.loginHandler,\n            loading: _this2.state.authLoading,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 183\n            },\n            __self: this\n          }));\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179\n        },\n        __self: this\n      }), React.createElement(Route, {\n        path: \"/signup\",\n        exact: true,\n        render: function render(props) {\n          return React.createElement(SignupPage, Object.assign({}, props, {\n            onSignup: _this2.signupHandler,\n            loading: _this2.state.authLoading,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 194\n            },\n            __self: this\n          }));\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190\n        },\n        __self: this\n      }), React.createElement(Redirect, {\n        to: \"/\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201\n        },\n        __self: this\n      }));\n\n      if (this.state.isAuth) {\n        routes = React.createElement(Switch, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 206\n          },\n          __self: this\n        }, React.createElement(Route, {\n          path: \"/\",\n          exact: true,\n          render: function render(props) {\n            return React.createElement(FeedPage, {\n              userId: _this2.state.userId,\n              token: _this2.state.token,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 211\n              },\n              __self: this\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 207\n          },\n          __self: this\n        }), React.createElement(Route, {\n          path: \"/:postId\",\n          render: function render(props) {\n            return React.createElement(SinglePostPage, Object.assign({}, props, {\n              userId: _this2.state.userId,\n              token: _this2.state.token,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 217\n              },\n              __self: this\n            }));\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 214\n          },\n          __self: this\n        }), React.createElement(Redirect, {\n          to: \"/\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 224\n          },\n          __self: this\n        }));\n      }\n\n      return React.createElement(Fragment, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229\n        },\n        __self: this\n      }, this.state.showBackdrop && React.createElement(Backdrop, {\n        onClick: this.backdropClickHandler,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231\n        },\n        __self: this\n      }), React.createElement(ErrorHandler, {\n        error: this.state.error,\n        onHandle: this.errorHandler,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 233\n        },\n        __self: this\n      }), React.createElement(Layout, {\n        header: React.createElement(Toolbar, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 236\n          },\n          __self: this\n        }, React.createElement(MainNavigation, {\n          onOpenMobileNav: this.mobileNavHandler.bind(this, true),\n          onLogout: this.logoutHandler,\n          isAuth: this.state.isAuth,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 237\n          },\n          __self: this\n        })),\n        mobileNav: React.createElement(MobileNavigation, {\n          open: this.state.showMobileNav,\n          mobile: true,\n          onChooseItem: this.mobileNavHandler.bind(this, false),\n          onLogout: this.logoutHandler,\n          isAuth: this.state.isAuth,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 245\n          },\n          __self: this\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      }), routes);\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport default withRouter(App);","map":{"version":3,"sources":["/home/bogdan/Documents/Node Js/React + node restapi/React/src/App.js"],"names":["React","Component","Fragment","Route","Switch","Redirect","withRouter","Layout","Backdrop","Toolbar","MainNavigation","MobileNavigation","ErrorHandler","FeedPage","SinglePostPage","LoginPage","SignupPage","App","state","showBackdrop","showMobileNav","isAuth","token","userId","authLoading","error","mobileNavHandler","isOpen","setState","backdropClickHandler","logoutHandler","localStorage","removeItem","loginHandler","event","authData","preventDefault","graphqlQuery","query","email","password","fetch","method","headers","body","JSON","stringify","then","res","json","resData","errors","status","Error","console","log","data","setItem","remainingMilliseconds","expiryDate","Date","getTime","toISOString","setAutoLogout","catch","err","signupHandler","signupForm","value","name","props","history","replace","milliseconds","setTimeout","errorHandler","getItem","routes","bind"],"mappings":"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","sourcesContent":["import React, { Component, Fragment } from \"react\";\nimport { Route, Switch, Redirect, withRouter } from \"react-router-dom\";\n\nimport Layout from \"./components/Layout/Layout\";\nimport Backdrop from \"./components/Backdrop/Backdrop\";\nimport Toolbar from \"./components/Toolbar/Toolbar\";\nimport MainNavigation from \"./components/Navigation/MainNavigation/MainNavigation\";\nimport MobileNavigation from \"./components/Navigation/MobileNavigation/MobileNavigation\";\nimport ErrorHandler from \"./components/ErrorHandler/ErrorHandler\";\nimport FeedPage from \"./pages/Feed/Feed\";\nimport SinglePostPage from \"./pages/Feed/SinglePost/SinglePost\";\nimport LoginPage from \"./pages/Auth/Login\";\nimport SignupPage from \"./pages/Auth/Signup\";\nimport \"./App.css\";\n\nclass App extends Component {\n  state = {\n    showBackdrop: false,\n    showMobileNav: false,\n    isAuth: false,\n    token: null,\n    userId: null,\n    authLoading: false,\n    error: null\n  };\n\n  componentDidMount() {\n    const token = localStorage.getItem(\"token\");\n    const expiryDate = localStorage.getItem(\"expiryDate\");\n    if (!token || !expiryDate) {\n      return;\n    }\n    if (new Date(expiryDate) <= new Date()) {\n      this.logoutHandler();\n      return;\n    }\n    const userId = localStorage.getItem(\"userId\");\n    const remainingMilliseconds =\n      new Date(expiryDate).getTime() - new Date().getTime();\n    this.setState({ isAuth: true, token: token, userId: userId });\n    this.setAutoLogout(remainingMilliseconds);\n  }\n\n  mobileNavHandler = isOpen => {\n    this.setState({ showMobileNav: isOpen, showBackdrop: isOpen });\n  };\n\n  backdropClickHandler = () => {\n    this.setState({ showBackdrop: false, showMobileNav: false, error: null });\n  };\n\n  logoutHandler = () => {\n    this.setState({ isAuth: false, token: null });\n    localStorage.removeItem(\"token\");\n    localStorage.removeItem(\"expiryDate\");\n    localStorage.removeItem(\"userId\");\n  };\n\n  loginHandler = (event, authData) => {\n    event.preventDefault();\n    const graphqlQuery = {\n      query: `{\n        login(email: \"${authData.email}\", password: \"${authData.password}\") {\n          token\n          userId\n        }\n      }`\n    };\n    this.setState({ authLoading: true });\n    fetch(\"http://localhost:8080/graphql\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(graphqlQuery)\n    })\n      .then(res => {\n        return res.json();\n      })\n      .then(resData => {\n        if (resData.errors && resData.errors[0].status === 422) {\n          throw new Error(\n            \"Validation failed. Make sure the email address isn't used yet!\"\n          );\n        }\n        if (resData.errors) {\n          throw Error(\"User login failed!\");\n        }\n        console.log(resData);\n        this.setState({\n          isAuth: true,\n          token: resData.data.token,\n          authLoading: false,\n          userId: resData.userId\n        });\n        localStorage.setItem(\"token\", resData.token);\n        localStorage.setItem(\"userId\", resData.userId);\n        const remainingMilliseconds = 60 * 60 * 1000;\n        const expiryDate = new Date(\n          new Date().getTime() + remainingMilliseconds\n        );\n        localStorage.setItem(\"expiryDate\", expiryDate.toISOString());\n        this.setAutoLogout(remainingMilliseconds);\n      })\n      .catch(err => {\n        console.log(err);\n        this.setState({\n          isAuth: false,\n          authLoading: false,\n          error: err\n        });\n      });\n  };\n\n  signupHandler = (event, authData) => {\n    event.preventDefault();\n    this.setState({ authLoading: true });\n    const graphqlQuery = {\n      query: `\n        mutation {\n          createUser(userInput: {email: \"${\n            authData.signupForm.email.value\n          }\", name: \"${authData.signupForm.name.value}\", password:\"${\n        authData.signupForm.password.value\n      }\"}) {\n            _id\n            email\n          }\n        }\n      `\n    };\n    fetch(\"http://localhost:8080/graphql\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(graphqlQuery)\n    })\n      .then(res => {\n        return res.json();\n      })\n      .then(resData => {\n        if (resData.errors && resData.errors[0].status === 422) {\n          throw new Error(\n            \"Validation failed. Make sure the email address isn't used yet!\"\n          );\n        }\n        if (resData.errors) {\n          console.log(resData);\n          throw Error(\"User creation failed!\");\n        }\n        console.log(resData);\n        this.setState({ isAuth: false, authLoading: false });\n        this.props.history.replace(\"/\");\n      })\n      .catch(err => {\n        console.log(err);\n        this.setState({\n          isAuth: false,\n          authLoading: false,\n          error: err\n        });\n      });\n  };\n\n  setAutoLogout = milliseconds => {\n    setTimeout(() => {\n      this.logoutHandler();\n    }, milliseconds);\n  };\n\n  errorHandler = () => {\n    this.setState({ error: null });\n  };\n\n  render() {\n    let routes = (\n      <Switch>\n        <Route\n          path=\"/\"\n          exact\n          render={props => (\n            <LoginPage\n              {...props}\n              onLogin={this.loginHandler}\n              loading={this.state.authLoading}\n            />\n          )}\n        />\n        <Route\n          path=\"/signup\"\n          exact\n          render={props => (\n            <SignupPage\n              {...props}\n              onSignup={this.signupHandler}\n              loading={this.state.authLoading}\n            />\n          )}\n        />\n        <Redirect to=\"/\" />\n      </Switch>\n    );\n    if (this.state.isAuth) {\n      routes = (\n        <Switch>\n          <Route\n            path=\"/\"\n            exact\n            render={props => (\n              <FeedPage userId={this.state.userId} token={this.state.token} />\n            )}\n          />\n          <Route\n            path=\"/:postId\"\n            render={props => (\n              <SinglePostPage\n                {...props}\n                userId={this.state.userId}\n                token={this.state.token}\n              />\n            )}\n          />\n          <Redirect to=\"/\" />\n        </Switch>\n      );\n    }\n    return (\n      <Fragment>\n        {this.state.showBackdrop && (\n          <Backdrop onClick={this.backdropClickHandler} />\n        )}\n        <ErrorHandler error={this.state.error} onHandle={this.errorHandler} />\n        <Layout\n          header={\n            <Toolbar>\n              <MainNavigation\n                onOpenMobileNav={this.mobileNavHandler.bind(this, true)}\n                onLogout={this.logoutHandler}\n                isAuth={this.state.isAuth}\n              />\n            </Toolbar>\n          }\n          mobileNav={\n            <MobileNavigation\n              open={this.state.showMobileNav}\n              mobile\n              onChooseItem={this.mobileNavHandler.bind(this, false)}\n              onLogout={this.logoutHandler}\n              isAuth={this.state.isAuth}\n            />\n          }\n        />\n        {routes}\n      </Fragment>\n    );\n  }\n}\n\nexport default withRouter(App);\n"]},"metadata":{},"sourceType":"module"}